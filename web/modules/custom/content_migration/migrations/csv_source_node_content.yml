id: csv_source_node_content
label: 'Migration content task'
source:
  plugin: csv
  path: modules/custom/content_migration/sources/task-migration-content.csv
  ids: [id]
  constants:
    log_message: 'Error migrating date due to invalid date format: '
process:
  type: type
  title: title
  validated_date:
    - plugin: validate_date
      source: date
  field_date/value:
    - plugin: skip_on_empty
      method: process
      source: '@validated_date'
    - plugin: format_date
      from_format: 'm/d/Y'
      to_format: 'Y-m-d'
  revision_log:
    plugin: if_condition
    source: '@validated_date'
    condition: empty
    do_process:
      plugin: concat
      source:
        - constants/log_message
        - date
  image_file_id:
    plugin: migration_lookup
    migration: csv_source_image_files
    source: id
  image_file_uri:
    plugin: entity_value
    source: '@image_file_id'
    entity_type: file
    field_name: uri
  image_file_path:
    plugin: file_uri_to_url
    source: '@image_file_uri'
  body/value:
    -
      plugin: custom_dom_replace
      source: content
  body/format:
    plugin: default_value
    default_value: basic_html
  field_category:
    -
      plugin: existing_term
      vocabulary: tags
      source: category
    -
      plugin: skip_on_empty
      method: row
destination:
  plugin: 'entity:node'
migration_dependencies:
  required:
    - csv_source_image_files
  optional: []
